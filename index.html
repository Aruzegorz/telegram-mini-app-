<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Generator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--tg-theme-hint-color, #708499);
            font-size: 0.9rem;
        }

        .tabs {
            display: flex;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 10px 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            white-space: nowrap;
            min-width: 70px;
        }

        .tab.active {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
        }

        .input, .textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            transition: border-color 0.2s;
        }

        .input:focus, .textarea:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #0088cc);
        }

        .textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }

        .button:hover {
            opacity: 0.8;
        }

        .button.secondary {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            color: var(--tg-theme-text-color, #000000);
            border: 1px solid var(--tg-theme-hint-color, #ddd);
        }

        .qr-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 16px;
            display: none;
        }

        .qr-code {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .history {
            margin-top: 30px;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .history-item:hover {
            opacity: 0.8;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            background: var(--tg-theme-button-color, #0088cc);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .history-content {
            flex: 1;
        }

        .history-title {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .history-text {
            font-size: 0.85rem;
            color: var(--tg-theme-hint-color, #708499);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .success-message {
            background: #4CAF50;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">üì± QR Generator</div>
        <div class="subtitle">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ QR-–∫–æ–¥—ã –¥–ª—è –ª—é–±—ã—Ö —Ü–µ–ª–µ–π</div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('text')">üìù –¢–µ–∫—Å—Ç</div>
        <div class="tab" onclick="switchTab('url')">üîó –°—Å—ã–ª–∫–∞</div>
        <div class="tab" onclick="switchTab('wifi')">üì∂ Wi-Fi</div>
        <div class="tab" onclick="switchTab('contact')">üë§ –ö–æ–Ω—Ç–∞–∫—Ç</div>
    </div>

    <!-- –¢–µ–∫—Å—Ç -->
    <div class="tab-content active" id="text-content">
        <div class="form-group">
            <label class="label">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç:</label>
            <textarea class="textarea" id="text-input" placeholder="–õ—é–±–æ–π —Ç–µ–∫—Å—Ç –¥–ª—è QR-–∫–æ–¥–∞..."></textarea>
        </div>
    </div>

    <!-- URL -->
    <div class="tab-content" id="url-content">
        <div class="form-group">
            <label class="label">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É:</label>
            <input type="url" class="input" id="url-input" placeholder="https://example.com">
        </div>
    </div>

    <!-- Wi-Fi -->
    <div class="tab-content" id="wifi-content">
        <div class="form-group">
            <label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–∏:</label>
            <input type="text" class="input" id="wifi-ssid" placeholder="MyWiFi">
        </div>
        <div class="form-group">
            <label class="label">–ü–∞—Ä–æ–ª—å:</label>
            <input type="text" class="input" id="wifi-password" placeholder="password123">
        </div>
        <div class="form-group">
            <label class="label">–¢–∏–ø –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</label>
            <select class="input" id="wifi-security">
                <option value="WPA">WPA/WPA2</option>
                <option value="WEP">WEP</option>
                <option value="nopass">–ë–µ–∑ –ø–∞—Ä–æ–ª—è</option>
            </select>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–∞–∫—Ç -->
    <div class="tab-content" id="contact-content">
        <div class="form-group">
            <label class="label">–ò–º—è:</label>
            <input type="text" class="input" id="contact-name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
        </div>
        <div class="form-group">
            <label class="label">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
            <input type="tel" class="input" id="contact-phone" placeholder="+7 900 123-45-67">
        </div>
        <div class="form-group">
            <label class="label">Email:</label>
            <input type="email" class="input" id="contact-email" placeholder="ivan@example.com">
        </div>
    </div>

    <button class="button" onclick="generateQR()">üéØ –°–æ–∑–¥–∞—Ç—å QR-–∫–æ–¥</button>
    
    <div class="success-message" id="success-message">
        QR-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! ‚úÖ
    </div>

    <div class="qr-container" id="qr-container">
        <canvas id="qr-canvas"></canvas>
        <div style="margin-top: 15px;">
            <button class="button secondary" onclick="downloadQR()">üì• –°–∫–∞—á–∞—Ç—å</button>
            <button class="button secondary" onclick="shareQR()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
        </div>
    </div>

    <div class="history">
        <h3 style="margin-bottom: 15px; color: var(--tg-theme-text-color, #000000);">üìú –ò—Å—Ç–æ—Ä–∏—è</h3>
        <div id="history-list">
            <div style="text-align: center; color: var(--tg-theme-hint-color, #708499); padding: 20px;">
                –°–æ–∑–¥–∞–Ω–Ω—ã–µ QR-–∫–æ–¥—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram?.WebApp;
        let currentTab = 'text';
        let history = JSON.parse(localStorage.getItem('qr-history') || '[]');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        if (tg) {
            tg.ready();
            tg.expand();
            try {
                tg.setHeaderColor('secondary_bg_color');
                tg.BackButton.show();
                tg.onEvent('backButtonClicked', () => tg.close());
            } catch (e) {}
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
            event.target.classList.add('active');
            document.getElementById(tabName + '-content').classList.add('active');
            
            currentTab = tabName;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
        function generateQR() {
            let text = '';
            let type = '';
            let title = '';

            switch(currentTab) {
                case 'text':
                    text = document.getElementById('text-input').value.trim();
                    type = '–¢–µ–∫—Å—Ç';
                    title = text.substring(0, 30) + (text.length > 30 ? '...' : '');
                    break;
                    
                case 'url':
                    text = document.getElementById('url-input').value.trim();
                    type = '–°—Å—ã–ª–∫–∞';
                    title = text.replace(/^https?:\/\//, '').substring(0, 30);
                    break;
                    
                case 'wifi':
                    const ssid = document.getElementById('wifi-ssid').value.trim();
                    const password = document.getElementById('wifi-password').value.trim();
                    const security = document.getElementById('wifi-security').value;
                    
                    if (!ssid) {
                        showError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–∏ Wi-Fi');
                        return;
                    }
                    
                    text = `WIFI:T:${security};S:${ssid};P:${password};;`;
                    type = 'Wi-Fi';
                    title = ssid;
                    break;
                    
                case 'contact':
                    const name = document.getElementById('contact-name').value.trim();
                    const phone = document.getElementById('contact-phone').value.trim();
                    const email = document.getElementById('contact-email').value.trim();
                    
                    if (!name && !phone && !email) {
                        showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞');
                        return;
                    }
                    
                    text = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\nTEL:${phone}\nEMAIL:${email}\nEND:VCARD`;
                    type = '–ö–æ–Ω—Ç–∞–∫—Ç';
                    title = name || phone || email;
                    break;
            }

            if (!text) {
                showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞');
                return;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥
            const canvas = document.getElementById('qr-canvas');
            QRCode.toCanvas(canvas, text, {
                width: 280,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (error) {
                if (error) {
                    showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–∞');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                document.getElementById('qr-container').style.display = 'block';
                showSuccess();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                addToHistory(type, title, text, canvas.toDataURL());
                
                // –í–∏–±—Ä–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞
                if (tg?.HapticFeedback) {
                    try {
                        tg.HapticFeedback.notificationOccurred('success');
                    } catch (e) {}
                }
            });
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞
        function downloadQR() {
            const canvas = document.getElementById('qr-canvas');
            const link = document.createElement('a');
            link.download = `qr-code-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            if (tg?.HapticFeedback) {
                try {
                    tg.HapticFeedback.impactOccurred('medium');
                } catch (e) {}
            }
        }

        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è QR-–∫–æ–¥–æ–º
        function shareQR() {
            const canvas = document.getElementById('qr-canvas');
            canvas.toBlob(function(blob) {
                if (navigator.share) {
                    const file = new File([blob], 'qr-code.png', { type: 'image/png' });
                    navigator.share({
                        files: [file],
                        title: 'QR-–∫–æ–¥',
                        text: '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π QR-–∫–æ–¥'
                    });
                } else {
                    // Fallback - –∫–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    const url = canvas.toDataURL();
                    navigator.clipboard.writeText(url).then(() => {
                        showSuccess('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                    });
                }
            });
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addToHistory(type, title, content, imageData) {
            const item = {
                id: Date.now(),
                type: type,
                title: title,
                content: content,
                imageData: imageData,
                date: new Date().toLocaleDateString('ru-RU')
            };
            
            history.unshift(item);
            if (history.length > 10) history.pop(); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            
            localStorage.setItem('qr-history', JSON.stringify(history));
            renderHistory();
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div style="text-align: center; color: var(--tg-theme-hint-color, #708499); padding: 20px;">
                        –°–æ–∑–¥–∞–Ω–Ω—ã–µ QR-–∫–æ–¥—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = history.map(item => `
                <div class="history-item" onclick="showHistoryItem(${item.id})">
                    <div class="history-icon">${getTypeIcon(item.type)}</div>
                    <div class="history-content">
                        <div class="history-title">${item.title}</div>
                        <div class="history-text">${item.type} ‚Ä¢ ${item.date}</div>
                    </div>
                </div>
            `).join('');
        }

        // –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ç–∏–ø–æ–≤
        function getTypeIcon(type) {
            const icons = {
                '–¢–µ–∫—Å—Ç': 'üìù',
                '–°—Å—ã–ª–∫–∞': 'üîó',
                'Wi-Fi': 'üì∂',
                '–ö–æ–Ω—Ç–∞–∫—Ç': 'üë§'
            };
            return icons[type] || 'üì±';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏
        function showHistoryItem(id) {
            const item = history.find(h => h.id === id);
            if (!item) return;
            
            const canvas = document.getElementById('qr-canvas');
            const img = new Image();
            img.onload = function() {
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                document.getElementById('qr-container').style.display = 'block';
                document.getElementById('qr-container').scrollIntoView({ behavior: 'smooth' });
            };
            img.src = item.imageData;
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showSuccess(message = 'QR-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! ‚úÖ') {
            const successMsg = document.getElementById('success-message');
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        function showError(message) {
            if (tg?.showAlert) {
                tg.showAlert(message);
            } else {
                alert(message);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏
        renderHistory();
    </script>
</body>
</html>

